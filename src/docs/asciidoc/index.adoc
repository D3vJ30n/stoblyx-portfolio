= 스토블릭스 API 문서 v1.0
:doctype: book
:icons: font
:source-highlighter: highlightjs
:toc: left
:toc-title: 목차
:sectlinks:
:sectnums:
:docinfo: shared

== 1. 개요

스토블릭스(Stoblyx)는 책 속 문장을 디지털 기념비(Obelisk)처럼 기억하고, AI를 통해 숏폼 영상으로 재탄생시키는 플랫폼입니다.
이 문서는 스토블릭스 API의 사용 방법과 세부 명세를 제공합니다.

=== 1.1 기술 스택

* Spring Boot 3.3.9 / Java 17
* MySQL 8.0.41 / Redis 7.0.15
* Spring Data JPA
* Spring Security + JWT
* AI 통합: KoBART, pyttsx3, Pexels API

== 2. 인증 및 권한

=== 2.1 인증 방식

스토블릭스 API는 JWT(JSON Web Token) 기반의 인증 방식을 사용합니다.

==== 2.1.1 토큰 발급

[source,http]
----
POST /api/auth/login HTTP/1.1
Content-Type: application/json

{
  "username": "user123",
  "password": "yourpassword"
}
----

[source,http]
----
HTTP/1.1 200 OK
Content-Type: application/json

{
  "result": "SUCCESS",
  "message": "로그인 성공",
  "data": {
    "accessToken": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
    "refreshToken": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
    "tokenType": "Bearer",
    "expiresIn": 86400
  }
}
----

==== 2.1.2 토큰 갱신

[source,http]
----
POST /api/auth/refresh HTTP/1.1
Content-Type: application/json

{
  "refreshToken": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."
}
----

=== 2.2 권한 등급

[cols="1,3,3"]
|===
|권한 |설명 |접근 가능 리소스

|USER
|일반 사용자
|기본 콘텐츠 열람, 문구 저장, 좋아요, 댓글

|EDITOR
|편집자
|콘텐츠 생성, 수정, 관리

|WRITER
|작가
|고급 콘텐츠 제작, 전문 카테고리 접근

|ADMIN
|관리자
|모든 시스템 리소스, 사용자 관리
|===

== 3. 사용자 API (User API)

=== 3.1 사용자 등록

[source,http]
----
POST /api/users/register HTTP/1.1
Content-Type: application/json

{
  "username": "newuser",
  "password": "securepassword",
  "email": "user@example.com",
  "nickname": "사용자닉네임"
}
----

=== 3.2 사용자 프로필 조회

[source,http]
----
GET /api/users/profile HTTP/1.1
Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
----

=== 3.3 사용자 정보 수정

[source,http]
----
PUT /api/users/profile HTTP/1.1
Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
Content-Type: application/json

{
  "nickname": "새닉네임",
  "profileImageUrl": "https://example.com/images/profile.jpg"
}
----

== 4. 문구 API (Quote API)

=== 4.1 문구 생성

[source,http]
----
POST /api/quotes HTTP/1.1
Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
Content-Type: application/json

{
  "content": "책 속의 한 문장은 사라지지 않는다. 그것은 오벨리스크처럼 남아, 사람들에게 영감을 준다.",
  "bookId": 123,
  "page": 45,
  "memo": "인상적인 문장"
}
----

=== 4.2 문구 목록 조회

[source,http]
----
GET /api/quotes?page=0&size=10 HTTP/1.1
Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
----

=== 4.3 특정 문구 조회

[source,http]
----
GET /api/quotes/{quoteId} HTTP/1.1
Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
----

=== 4.4 문구 수정

[source,http]
----
PUT /api/quotes/{quoteId} HTTP/1.1
Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
Content-Type: application/json

{
  "content": "수정된 문구 내용",
  "page": 46,
  "memo": "수정된 메모"
}
----

=== 4.5 문구 삭제

[source,http]
----
DELETE /api/quotes/{quoteId} HTTP/1.1
Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
----

== 5. AI 숏폼 생성 API (Short-form Content API)

=== 5.1 숏폼 콘텐츠 생성 요청

[source,http]
----
POST /api/quotes/{quoteId}/generate-video HTTP/1.1
Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
Content-Type: application/json

{
  "style": "minimalist",
  "bgmType": "calm"
}
----

[source,http]
----
HTTP/1.1 201 Created
Content-Type: application/json

{
  "result": "SUCCESS",
  "message": "숏폼 콘텐츠 생성 요청이 접수되었습니다",
  "data": {
    "contentId": "a1b2c3d4",
    "status": "PROCESSING",
    "estimatedCompletionTime": 45
  }
}
----

=== 5.2 숏폼 콘텐츠 상태 확인

[source,http]
----
GET /api/contents/status/{contentId} HTTP/1.1
Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
----

[source,http]
----
HTTP/1.1 200 OK
Content-Type: application/json

{
  "result": "SUCCESS",
  "message": "콘텐츠 상태 조회 성공",
  "data": {
    "contentId": "a1b2c3d4",
    "status": "COMPLETED",
    "previewUrl": "https://cdn.stoblyx.com/previews/a1b2c3d4.mp4",
    "completedAt": "2025-02-23T14:30:45Z"
  }
}
----

=== 5.3 숏폼 콘텐츠 목록 조회

[source,http]
----
GET /api/contents?page=0&size=10 HTTP/1.1
Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
----

=== 5.4 특정 숏폼 콘텐츠 조회

[source,http]
----
GET /api/contents/{contentId} HTTP/1.1
Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
----

== 6. 소셜 기능 API (Social API)

=== 6.1 좋아요 추가/취소

[source,http]
----
POST /api/quotes/{quoteId}/like HTTP/1.1
Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
----

=== 6.2 댓글 작성

[source,http]
----
POST /api/quotes/{quoteId}/comments HTTP/1.1
Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
Content-Type: application/json

{
  "content": "정말 인상적인 문구네요!"
}
----

=== 6.3 댓글 목록 조회

[source,http]
----
GET /api/quotes/{quoteId}/comments?page=0&size=10 HTTP/1.1
Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
----

=== 6.4 문구 저장

[source,http]
----
POST /api/quotes/{quoteId}/save HTTP/1.1
Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
Content-Type: application/json

{
  "note": "나중에 다시 읽어보기"
}
----

== 7. 검색 API (Search API)

=== 7.1 문구 검색

[source,http]
----
GET /api/search/quotes?keyword=오벨리스크&page=0&size=10 HTTP/1.1
Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
----

=== 7.2 책 검색

[source,http]
----
GET /api/search/books?title=미래의&author=알랭&page=0&size=10 HTTP/1.1
Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
----

=== 7.3 인기 검색어 조회

[source,http]
----
GET /api/search/popular?limit=10 HTTP/1.1
Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
----

== 8. 랭킹 및 게이미피케이션 API (Ranking API)

=== 8.1 전체 랭킹 조회

[source,http]
----
GET /api/rankings/global?page=0&size=10 HTTP/1.1
Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
----

=== 8.2 친구 랭킹 조회

[source,http]
----
GET /api/rankings/friends?page=0&size=10 HTTP/1.1
Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
----

=== 8.3 사용자 점수 조회

[source,http]
----
GET /api/rankings/score HTTP/1.1
Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
----

=== 8.4 보상 목록 조회

[source,http]
----
GET /api/rewards?page=0&size=10 HTTP/1.1
Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
----

=== 8.5 보상 수령

[source,http]
----
POST /api/rewards/{rewardId}/claim HTTP/1.1
Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
----

== 9. 관리자 API (Admin API)

=== 9.1 콘텐츠 관리

==== 9.1.1 콘텐츠 승인

[source,http]
----
PUT /api/admin/contents/{contentId}/approve HTTP/1.1
Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
----

==== 9.1.2 콘텐츠 거부

[source,http]
----
PUT /api/admin/contents/{contentId}/reject HTTP/1.1
Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
Content-Type: application/json

{
  "reason": "부적절한 내용이 포함되어 있습니다"
}
----

=== 9.2 사용자 관리

==== 9.2.1 사용자 목록 조회

[source,http]
----
GET /api/admin/users?page=0&size=10 HTTP/1.1
Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
----

==== 9.2.2 사용자 권한 변경

[source,http]
----
PUT /api/admin/users/{userId}/role HTTP/1.1
Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
Content-Type: application/json

{
  "role": "EDITOR"
}
----

==== 9.2.3 사용자 계정 비활성화

[source,http]
----
PUT /api/admin/users/{userId}/deactivate HTTP/1.1
Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
Content-Type: application/json

{
  "reason": "사용자 요청에 의한 비활성화"
}
----

=== 9.3 통계 대시보드

==== 9.3.1 콘텐츠 생성 통계

[source,http]
----
GET /api/admin/stats/contents?period=daily HTTP/1.1
Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
----

==== 9.3.2 사용자 활동 통계

[source,http]
----
GET /api/admin/stats/users?period=weekly HTTP/1.1
Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
----

==== 9.3.3 시스템 리소스 모니터링

[source,http]
----
GET /api/admin/stats/system HTTP/1.1
Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
----

== 10. 오류 코드 및 응답

=== 10.1 표준 오류 응답 형식

[source,json]
----
{
  "result": "ERROR",
  "message": "오류 메시지",
  "data": null
}
----

=== 10.2 HTTP 상태 코드

[cols="1,3,3"]
|===
|상태 코드 |설명 |예시 상황

|200 OK
|요청이 성공적으로 처리됨
|리소스 조회, 업데이트 성공

|201 Created
|리소스가 성공적으로 생성됨
|새로운 사용자, 문구, 콘텐츠 생성

|400 Bad Request
|잘못된 요청 형식이나 유효하지 않은 데이터
|필수 필드 누락, 유효하지 않은 파라미터

|401 Unauthorized
|인증이 필요함
|유효하지 않거나 만료된 토큰

|403 Forbidden
|인증은 되었으나 리소스에 접근 권한이 없음
|관리자 기능에 일반 사용자 접근 시도

|404 Not Found
|요청한 리소스가 존재하지 않음
|존재하지 않는 ID 조회

|409 Conflict
|요청이 현재 서버 상태와 충돌
|이미 존재하는 사용자명 중복 등록

|500 Internal Server Error
|서버 내부 오류
|예상치 못한 시스템 오류
|===

== 11. 데이터 모델

=== 11.1 User (사용자)

[cols="1,1,3"]
|===
|필드 |타입 |설명

|id
|Long
|사용자 고유 식별자

|username
|String
|사용자 아이디 (50자 이내, 고유값)

|password
|String
|암호화된 비밀번호 (255자 이내)

|nickname
|String
|사용자 별명 (50자 이내)

|email
|String
|이메일 주소 (100자 이내, 고유값)

|profileImageUrl
|String
|프로필 이미지 경로 (255자 이내)

|role
|Enum
|사용자 권한 (USER, ADMIN, EDITOR, WRITER)

|accountStatus
|String
|계정 상태 (ACTIVE, SUSPENDED, INACTIVE)

|lastLoginAt
|LocalDateTime
|마지막 로그인 시간
|===

=== 11.2 Quote (문구)

[cols="1,1,3"]
|===
|필드 |타입 |설명

|id
|Long
|문구 고유 식별자

|content
|String
|문구 내용 (1000자 이내)

|page
|Integer
|페이지 번호

|memo
|String
|사용자 메모 (500자 이내)

|likeCount
|Integer
|좋아요 수

|saveCount
|Integer
|저장 수

|userId
|Long
|문구 등록자 ID

|bookId
|Long
|문구가 속한 책 ID
|===

=== 11.3 ShortFormContent (숏폼 콘텐츠)

[cols="1,1,3"]
|===
|필드 |타입 |설명

|id
|Long
|콘텐츠 고유 식별자

|title
|String
|콘텐츠 제목 (100자 이내)

|description
|String
|콘텐츠 설명 (500자 이내)

|status
|Enum
|콘텐츠 상태 (PROCESSING, COMPLETED, FAILED, PUBLISHED)

|contentType
|Enum
|콘텐츠 유형 (VIDEO, AUDIO, IMAGE, TEXT, MIXED)

|viewCount
|Integer
|조회수

|likeCount
|Integer
|좋아요 수

|shareCount
|Integer
|공유 수

|commentCount
|Integer
|댓글 수

|duration
|Integer
|콘텐츠 길이(초)

|subtitles
|String
|자막 내용

|videoUrl
|String
|비디오 URL

|thumbnailUrl
|String
|썸네일 URL

|audioUrl
|String
|오디오 URL

|bookId
|Long
|연관된 책 ID

|quoteId
|Long
|연관된 문구 ID
|===

== 12. 버전 관리

API 버전은 URI 경로에 포함되지 않습니다.
대신 Accept 헤더를 사용하여 API 버전을 지정합니다.

[source,http]
----
Accept: application/vnd.stoblyx.v1+json
----

== 13. 제한 사항

=== 13.1 요청 제한

* 일반 사용자: 분당 60회 요청
* 유료 사용자: 분당 120회 요청
* 관리자: 제한 없음

=== 13.2 콘텐츠 생성 제한

[cols="1,1,3"]
|===
|랭크 |일일 콘텐츠 생성 제한 |설명

|BRONZE
|3회
|기본 기능 사용 가능

|SILVER
|5회
|일일 콘텐츠 생성 5회, 프리미엄 BGM

|GOLD
|10회
|일일 콘텐츠 생성 10회, 고급 템플릿

|PLATINUM
|20회
|AI 추천 영상 제작 가능, 고급 템플릿

|DIAMOND
|무제한
|모든 혜택 + 콘텐츠 우선 노출
|===

== 14. 서비스 수준 계약 (SLA)

* 서비스 가용성: 99.9%
* 평균 응답 시간: 500ms 이하
* 콘텐츠 생성 처리 시간: 평균 45초

== 15. 부록

=== 15.1 웹훅 (Webhook) 사용

숏폼 콘텐츠 생성이 완료되면 웹훅을 통해 알림을 받을 수 있습니다.

[source,http]
----
POST /api/webhooks/register HTTP/1.1
Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
Content-Type: application/json

{
  "url": "https://your-service.com/callbacks/stoblyx",
  "events": ["content.created", "content.failed"],
  "secret": "your-secret-key"
}
----

=== 15.2 샘플 코드

.Java를 사용한 인증 예제
[source,java]
----
import org.springframework.http.HttpEntity;
import org.springframework.http.HttpHeaders;
import org.springframework.http.HttpMethod;
import org.springframework.http.ResponseEntity;
import org.springframework.web.client.RestTemplate;

public class StobyxApiClient {
    private final String baseUrl = "https://api.stoblyx.com";
    private String accessToken;
    
    public void login(String username, String password) {
        RestTemplate restTemplate = new RestTemplate();
        HttpHeaders headers = new HttpHeaders();
        headers.set("Content-Type", "application/json");
        
        String body = String.format("{\"username\":\"%s\",\"password\":\"%s\"}", username, password);
        HttpEntity<String> entity = new HttpEntity<>(body, headers);
        
        ResponseEntity<LoginResponse> response = restTemplate.exchange(
            baseUrl + "/api/auth/login",
            HttpMethod.POST,
            entity,
            LoginResponse.class
        );
        
        this.accessToken = response.getBody().getData().getAccessToken();
    }
    
    public QuoteResponse getQuote(Long quoteId) {
        RestTemplate restTemplate = new RestTemplate();
        HttpHeaders headers = new HttpHeaders();
        headers.set("Authorization", "Bearer " + accessToken);
        
        HttpEntity<String> entity = new HttpEntity<>(headers);
        
        ResponseEntity<QuoteResponse> response = restTemplate.exchange(
            baseUrl + "/api/quotes/" + quoteId,
            HttpMethod.GET,
            entity,
            QuoteResponse.class
        );
        
        return response.getBody();
    }
}
----